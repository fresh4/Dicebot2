"use strict";class MoneyConverter{static make$Converter(a,b){const c=b.d||{},d=.02,e=[new MoneyConverterUnit("Copper",1,"cp"),new MoneyConverterUnit("Silver",10,"sp"),new MoneyConverterUnit("Electrum",50,"ep"),new MoneyConverterUnit("Gold",100,"gp"),new MoneyConverterUnit("Platinum",1e3,"pp"),new MoneyConverterUnit("Nib (WDH)",1,"nib"),new MoneyConverterUnit("Shard (WDH)",10,"shard"),new MoneyConverterUnit("Taol (WDH)",200,"taol"),new MoneyConverterUnit("Dragon (WDH)",100,"dgn"),new MoneyConverterUnit("Sun (WDH)",1e3,"sun"),new MoneyConverterUnit("Harbor Moon (WDH)",5e3,"moon")],f=[...e].map((a,b)=>(a.ix=b,a)).reverse(),g=3,h=$(`<div class="dm_money split-column"/>`),i=()=>{var b=Math.floor;if(l.find(`.dm_money__row`).length||k(),Object.entries(c).forEach(([a,b])=>{u.find(`option[value=${a}]`).toggle(!b)}),c[u.val()])return u.val("-1"),void i();const g=l.find(`.dm_money__row`).removeClass("error-background");t.removeClass("error-background");const h=+u.val()||0,j=[];let m=0;const n=(t.val()||"").trim();let o=1;if(n){const a=+n;isNaN(a)?t.addClass("error-background"):o=a}if(-1==h){const a=[],h=[],i=new Set;g.each((b,c)=>{const d=$(c),f=(d.find(`input`).val()||"").trim();if(f){const b=+f;if(isNaN(b))d.addClass("error-background");else{const c=+d.find(`select`).val();a[c]=(a[c]||0)+b,i.add(e[c]._cat)}}}),1<o&&f.forEach((d,e)=>{const g=a[d.ix];if(g){let h=g%o*d.mult;a[d.ix]=b(g/o);for(let d=e+1;d<f.length;++d){const e=f[d];!c[e.ix]&&h>=e.mult&&(a[e.ix]=(a[e.ix]||0)+b(h/e.mult),h%=e.mult)}}}),f.forEach(b=>{const c=a[b.ix]||0,e=h[b.ix]||0;if(c||e){const a=c+e;m+=a*d,j.push(`${a.toLocaleString()} ${b.abbv}`)}})}else{let a=0;g.each((b,c)=>{const d=$(c),f=(d.find(`input`).val()||"").trim();if(f){const b=+f;isNaN(b)?d.addClass("error-background"):a+=b*(e[d.find(`select`).val()]||e[0]).mult}});const i=b(a/o),k=f.filter(a=>!c[a.ix]&&a.ix<=h);let l=i;k.forEach(a=>{if(l>=a.mult){const c=l%a.mult,e=b(l/a.mult);m+=d*e,l=c,j.push(`${e.toLocaleString()} ${a.abbv}`)}})}r.val(`${j.join("; ")}${m?` (${m.toLocaleString()} lbs.)`:""}`),a.doSaveStateDebounced()},j=a=>$(`<select class="form-control input-sm" style="padding: 5px">${a?`<option value="-1">(No conversion)</option>`:""}${e.map((a,b)=>`<option value="${b}">${a.n}</option>`).join("")}</select>`),k=(a,b)=>{const c=$(`<div class="dm_money__row"/>`).appendTo(l),d=$(`<input type="number" step="1" placeholder="Coins" class="form-control input-sm">`).appendTo(c).change(i);null!=b&&d.val(b);const e=j().appendTo(c).change(i);e.val(null==a?g:a);$(`<button class="btn btn-sm btn-danger" title="Remove Row"><span class="glyphicon glyphicon-trash"></span></button>`).appendTo(c).click(()=>{c.remove(),i()})},l=$(`<div class="dm_money__rows"/>`).appendTo(h),m=$(`<div class="split dm_money__ctrl"/>`).appendTo(h),n=$(`<div class="dm_money__ctrl__lhs split-child" style="width: 66%;"/>`).appendTo(m),o=$(`<div class="split"/>`).appendTo(n),p=$(`<button class="btn btn-primary btn-sm" title="Add Row"><span class="glyphicon glyphicon-plus"/></button>`).appendTo(o).click(()=>{k(),i()}),q=$(`<button class="btn btn-default btn-sm" title="Settings"><span class="glyphicon glyphicon-cog"/></button>`).appendTo(o).click(()=>{const a=UiUtil.getShow$Modal("Settings",()=>i());[...f].reverse().forEach(b=>{UiUtil.$getAddModalRowCb(a,`Disable ${b.n}`,c,b.ix)})}),r=$(`<input class="form-control input-sm dm_money__out" disabled/>`).appendTo(n).mousedown(async()=>{await MiscUtil.pCopyTextToClipboard(r.val()),JqueryUtil.showCopiedEffect(r)}),s=$(`<div class="dm_money__ctrl__rhs split-child" style="width: 33%;"/>`).appendTo(m),t=$(`<input type="number" min="1" step="1" placeholder="Split Between..." class="form-control input-sm">`).appendTo(s).change(i),u=j(!0).appendTo(s).change(i);return h.data("getState",()=>({c:u.val(),s:t.val(),r:l.find(`.dm_money__row`).map((a,b)=>{const c=$(b);return{c:c.find(`select`).val(),n:c.find(`input`).val()}}).get(),d:c})),b&&(u.val(null==b.c?g:b.c),t.val(b.s),(b.r||[]).forEach(a=>k(a.c,a.n))),i(),h}}class MoneyConverterUnit{constructor(a,b,c){this.n=a,this.mult=b,this.abbv=c}}